# ==============================================================================
# Tests the functionality for the g:doge_comment_interactive option.
# ==============================================================================
Given php (function with parameters where g:doge_comment_interactive = 1):
  function myFunction(array &$p1, string $p2, &$p3 = NULL, \Drupal\core\Entity\Node $p4) {}

Do (trigger doge):
  :let g:doge_comment_interactive = 1\<CR>
  \<C-d>

Then (expect the first TODO in the comment to be selected):
  AssertEqual 's', mode()
  AssertEqual 2, line('.')
  AssertEqual 4, col('.')

Expect php (generated comment with @param tags):
  /**
   * TODO
   *
   * @param array $p1 TODO
   * @param string $p2 TODO
   * @param mixed $p3 TODO
   * @param \Drupal\core\Entity\Node $p4 TODO
   */
  function myFunction(array &$p1, string $p2, &$p3 = NULL, \Drupal\core\Entity\Node $p4) {}

# ------------------------------------------------------------------------------

Do (trigger doge and try to jump backwards outside of the comment):
  \<C-d>
  \<S-Tab>

Then (expect the first TODO in the comment to be selected):
  AssertEqual 's', mode()
  AssertEqual 2, line('.')
  AssertEqual 4, col('.')

# ------------------------------------------------------------------------------

Do (trigger doge and try to jump forwards outside of the comment):
  \<C-d>
  \<Tab>
  \<Tab>
  \<Tab>
  \<Tab>
# 4x <Tab will already be at the last TODO, so we'll trigger it 5 times.
  \<Tab>

Then (expect the last TODO in the comment to be selected):
  AssertEqual 's', mode()
  AssertEqual 7, line('.')
  AssertEqual 40, col('.')

# ------------------------------------------------------------------------------

Do (trigger doge and jump forward):
  \<C-d>
  \<Tab>

Then (expect the second TODO in the comment to be selected):
  AssertEqual 's', mode()
  AssertEqual 4, line('.')
  AssertEqual 21, col('.')

# ------------------------------------------------------------------------------

Do (trigger doge and jump forward until the last TODO item):
  \<C-d>
  \<Tab>
  \<Tab>
  \<Tab>
  \<Tab>

Then (expect the last TODO in the comment to be selected):
  AssertEqual 's', mode()
  AssertEqual 7, line('.')
  AssertEqual 40, col('.')

# ------------------------------------------------------------------------------

Do (trigger doge and jump forward while filling in text):
  :let g:doge_comment_interactive = 1\<CR>
  \<C-d>
  myFunction
  \<Tab>
  Lorem ipsum.
  \<Tab>
  Dor sit amet.
  \<Tab>
  \<CR>
  \<Space>
  \<Space>
  Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  \<Tab>
  \<CR>
  \<Space>
  \<Space>
  Lorem ipsum dor sit amet.
# Enter two extra tabs to test whether we receive an actual <Tab> character
  \<Tab>
  \<Tab>

Then (expect b:doge_interactive to be destroyed):
  AssertEqual 0, exists('b:doge_interactive')

Expect php (generated comment with @param tags with brief descriptions):
  /**
   * myFunction
   *
   * @param array $p1 Lorem ipsum.
   * @param string $p2 Dor sit amet.
   * @param mixed $p3 
   *   Lorem ipsum dolor sit amet, consectetur adipiscing elit.
   * @param \Drupal\core\Entity\Node $p4 
   *   Lorem ipsum dor sit amet.    
   */
  function myFunction(array &$p1, string $p2, &$p3 = NULL, \Drupal\core\Entity\Node $p4) {}

Do (let g:doge_comment_interactive = 0):
  :let g:doge_comment_interactive = 0\<CR>
